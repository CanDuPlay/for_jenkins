webpackJsonp([21],{"568Q":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),o=a.n(s),n={data:function(){return{name:"",dateValue:"",startDate:"",endtDate:"",pandectList:[{name:"学校数量",num:30},{name:"建筑面积",num:30},{name:"新增学位",num:30},{name:"规划总投资",num:30},{name:"累计完成投资",num:30}],value:"",options:[{value:"",label:"全部"},{value:"0",label:"未申报"},{value:"1",label:"已申报"}],tableData:[{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1516 弄",contact:"赵四<br/>13812345678"},{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1516 弄",contact:"赵四<br/>13812345678"},{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1516 弄",contact:"赵四<br/>13812345678"}],dialogVisible:!1,dialogTime:!1,dialogTextarea:"",year:"",stage:"",shenbao:"",schoolId:"",schoolName:"",project:{},pageSize:10,currentPage:1,townList:[],page:{},stageList:[],roleId:sessionStorage.getItem("roleId"),townId:"",duanxinTownId:"",projectId:sessionStorage.getItem("projectId"),projectName:sessionStorage.getItem("projectName"),daopaiList:[{name:"",time:"",isFinish:0}],teacherList:[]}},mounted:function(){this.$nextTick(function(){"null"!=sessionStorage.getItem("townId")&&(this.townId=sessionStorage.getItem("townId")),this.initTown(),this.queryStage(),this.init(),this.initSchoolList()})},methods:{init:function(){var t=this;this.$post("/web/queryTownProject",{projectId:this.projectId,townId:this.townId}).then(function(e){0==e.resultCode&&(t.project=e.content.project)})},initSchoolList:function(){var t=this;this.$post("/web/querySchoolList",{projectId:this.projectId,townId:this.townId,year:this.year,schoolName:this.schoolName,stage:this.stage,shenbao:this.shenbao,page:this.currentPage-1,size:this.pageSize}).then(function(e){0==e.resultCode&&(t.page=e.content.page)})},search:function(){this.initSchoolList()},initTown:function(){var t=this;this.$post("/web/queryTownByProjectId",{projectId:this.projectId}).then(function(e){t.townList=e.content.list,t.townList.unshift({id:"",name:"全部"})})},queryStage:function(){var t=this;this.$post("/web/queryStage",{projectId:this.projectId}).then(function(e){t.stageList=e.content.list,t.stageList.unshift({id:"",name:"全部"})})},handleSizeChange:function(t){this.pageSize=t,this.initSchoolList()},handleCurrentChange:function(t){this.currentPage=t,this.initSchoolList()},turnToAdd:function(t){this.$router.push({name:"CountyProjectCreateSchool",params:{projectId:this.projectId,projectName:this.project.name,startTime:this.project.startTime,endTime:this.project.endTime,schoolId:t}})},addDaoPai:function(){this.daopaiList.push({name:"",time:"",isFinish:0})},saveDaopai:function(){var t=this;this.$post("/web/shezhiDaopaishijian",{schoolId:this.schoolId,timeStr:o()(this.daopaiList)}).then(function(e){t.$message({type:"success",message:"设置成功!"}),t.dialogTime=!1})},shezhi:function(t){var e=this;e.schoolId=t,this.$post("/web/queryDaopaishijian",{schoolId:t}).then(function(t){e.daopaiList=t.content.list,e.dialogTime=!0})},turnTo:function(t,e,a){sessionStorage.setItem("projectId",e.projectId),sessionStorage.setItem("schoolId",e.id),this.$router.push({name:t,params:{projectId:e.projectId,schoolId:e.id,edit:a,schoolScheduleId:e.schoolScheduleId}})},deleteSchool:function(t){var e=this;this.$confirm("删除后将无法恢复，确定删除该数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$post("/web/deleteSchool",{schoolId:t.id}).then(function(t){0==t.resultCode?(e.$message({type:"success",message:"学校删除成功！"}),e.initSchoolList()):e.$message({type:"info",message:t.resultDesc})})}).catch(function(){e.$message({showClose:!0,type:"info",message:"已取消删除！"})})},duanxin:function(t){this.duanxinTownId=t.townId;var e=this;this.$post("/web/queryTownLeader",{townId:t.townId}).then(function(t){e.dialogVisible=!0,e.teacherList=t.content.teacherList})},fasong:function(){var t=this;if(""==this.dialogTextarea)return this.$message({type:"info",message:"短信发送内容不能为空！"}),!1;this.$post("/web/sendMessage",{townId:this.duanxinTownId,remindContent:this.dialogTextarea}).then(function(e){t.dialogVisible=!1,t.$message({type:"success",message:"短信发送成功！"})})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"city-project__detail plate"},[a("div",{staticClass:"pandect plate-top"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"margin-bottom__medium",attrs:{span:12}},[a("el-input",{attrs:{disabled:""},model:{value:t.project.name,callback:function(e){t.$set(t.project,"name",e)},expression:"project.name"}})],1),t._v(" "),a("el-col",{staticClass:"clearfix margin-bottom__medium",attrs:{span:12}},[a("el-date-picker",{staticClass:"year-date",attrs:{type:"year",placeholder:"开工年份",disabled:""},model:{value:t.project.startTime,callback:function(e){t.$set(t.project,"startTime",e)},expression:"project.startTime"}}),t._v(" "),a("el-date-picker",{staticClass:"year-date",attrs:{type:"year",placeholder:"竣工年份",disabled:""},model:{value:t.project.endTime,callback:function(e){t.$set(t.project,"endTime",e)},expression:"project.endTime"}})],1),t._v(" "),a("el-col",{staticClass:"clearfix",attrs:{span:24}},[a("div",{staticClass:"pandect-item pull-left"},[a("p",{staticClass:"color_6 margin-bottom__small"},[t._v("学校数量")]),t._v(" "),t.project.schoolNum>0?a("span",{staticClass:"pandect-block"},[t._v(t._s(t.project.schoolNum))]):a("span",{staticClass:"pandect-block"})]),t._v(" "),a("div",{staticClass:"pandect-item pull-left"},[a("p",{staticClass:"color_6 margin-bottom__small"},[t._v("建筑面积")]),t._v(" "),a("span",{staticClass:"pandect-block"},[t._v(t._s(t.project.area))])]),t._v(" "),a("div",{staticClass:"pandect-item pull-left"},[a("p",{staticClass:"color_6 margin-bottom__small"},[t._v("新增学位")]),t._v(" "),a("span",{staticClass:"pandect-block"},[t._v(t._s(t.project.newBuild))])]),t._v(" "),a("div",{staticClass:"pandect-item pull-left"},[a("p",{staticClass:"color_6 margin-bottom__small"},[t._v("规划总投资（万元）")]),t._v(" "),a("span",{staticClass:"pandect-block"},[t._v(t._s(t.project.invest))])]),t._v(" "),a("div",{staticClass:"pandect-item pull-left"},[a("p",{staticClass:"color_6 margin-bottom__small"},[t._v("累计总投资（万元）")]),t._v(" "),a("span",{staticClass:"pandect-block"},[t._v(t._s(t.project.totalInvest))])])])],1)],1),t._v(" "),a("div",{staticClass:"table-wrapper plate-bottom has-padding"},[a("el-form",{staticClass:"clearfix",attrs:{inline:""}},[a("el-form-item",[a("el-date-picker",{staticStyle:{width:"120px"},attrs:{format:"yyyy-MM",type:"month",placeholder:"选择年月","value-format":"timestamp"},model:{value:t.year,callback:function(e){t.year=e},expression:"year"}})],1),t._v(" "),a("el-form-item",[110005==t.roleId?a("el-select",{staticStyle:{width:"110px"},attrs:{placeholder:"请选择"},model:{value:t.townId,callback:function(e){t.townId=e},expression:"townId"}},t._l(t.townList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e()],1),t._v(" "),a("el-form-item",[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"学校关键词查询"},model:{value:t.schoolName,callback:function(e){t.schoolName=e},expression:"schoolName"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.search}},[t._v("查询")])],1),t._v(" "),a("el-form-item",{staticClass:"pull-right"},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"申报状态"},on:{change:t.search},model:{value:t.shenbao,callback:function(e){t.shenbao=e},expression:"shenbao"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",{staticClass:"pull-right"},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"开工状态"},on:{change:t.search},model:{value:t.stage,callback:function(e){t.stage=e},expression:"stage"}},t._l(t.stageList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),110001==t.roleId?a("div",{staticClass:"text-right margin-bottom__small"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.turnToAdd("")}}},[t._v("创建项目学校")])],1):t._e()],1),t._v(" "),a("el-table",{staticClass:"margin-bottom__small",staticStyle:{width:"100%"},attrs:{data:t.page.content}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"townName",label:"归属区县",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"schoolName",label:"项目学校",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[110001==t.roleId?a("span",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.turnToAdd(s.id)}}},[t._v(t._s(s.schoolName))]):a("span",[t._v(t._s(s.schoolName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"schoolType",label:"学校类型",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"area",label:"建筑面积",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"newBuild",label:"新增学位",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"invest",label:"规划总投资(万元)",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"建设时段（开工/竣工）",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{staticClass:"state-style is-state__1-text"},[t._v(t._s(s.startYear)+" ~ "+t._s(s.endYear))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"isDaopai",label:"项目状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{staticClass:"state-style is-state__1-text"},[t._v(t._s(s.nowSchedule))]),t._v(" "),110001==t.roleId&&1==s.isDaopai?a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.shezhi(s.id)}}},[t._v("设置")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"shenBao",label:"申报状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.shenBao?a("span",{staticClass:"state-style is-state__1-text"},[t._v("已申报")]):a("span",{staticClass:"state-style is-state__3-text"},[t._v("未申报")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"roleStatus",label:"上级审阅状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[1==s.roleStatus||""===s.roleStatus||null==s.roleStatus?a("span",{staticClass:"state-style is-state__1-text"},[t._v("-")]):0==s.roleStatus?a("span",{staticClass:"state-style is-state__3-text"},[t._v("退回")]):s.roleStatus>1?a("span",{staticClass:"state-style is-state__1-text"},[t._v("通过")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"操作",width:"260",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[110001!=t.roleId||!s.shenBao||2!=s.projectStatus||0!=s.roleStatus&&1!=s.roleStatus&&""!=s.roleStatus&&null!=s.roleStatus?t._e():a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.turnTo("CountyProjectEdit",s,"edit")}}},[t._v("修改")]),t._v(" "),110001==t.roleId&&s.shenBao&&2==s.projectStatus?a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.turnTo("CountyProjectEdit",s,"see")}}},[t._v("查看")]):110001==t.roleId&&!s.shenbao&&2==s.projectStatus&&t.project.finshStatus?a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.turnTo("CountyProjectEdit",s,"add")}}},[t._v("申报")]):t._e(),t._v(" "),110001==t.roleId&&2==s.projectStatus?a("el-button",{on:{click:function(e){return t.deleteSchool(s)}}},[t._v("删除")]):t._e(),t._v(" "),110005==t.roleId&&s.shenBao?a("el-button",{on:{click:function(e){return t.turnTo("CityProjectSchoolDetail",s,"")}}},[t._v("查看")]):t._e(),t._v(" "),110005==t.roleId?a("el-button",{on:{click:function(e){return t.duanxin(s)}}},[t._v("短信催办")]):t._e()]}}])})],1),t._v(" "),t.page.totalPages>0?a("el-pagination",{staticClass:"is-background-white text-center",attrs:{"current-page":t.currentPage,"page-sizes":[10,20,30,40,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.page.totalElements},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e()],1),t._v(" "),a("el-dialog",{staticClass:"common-modal",attrs:{title:"短信催办",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("p",{staticClass:"dialog-addressee margin-bottom__small"},[t._v("收件人:")]),t._v(" "),t._l(t.teacherList,function(e,s){return a("p",{key:s,staticClass:"dialog-addressee margin-bottom__small"},[t._v("    "+t._s(e.name)+"（"+t._s(e.phone)+"）")])}),t._v(" "),a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:t.dialogTextarea,callback:function(e){t.dialogTextarea=e},expression:"dialogTextarea"}}),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.fasong}},[t._v("发送")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)],2),t._v(" "),a("el-dialog",{staticClass:"common-modal",attrs:{title:"倒排时间",visible:t.dialogTime,width:"50%"},on:{"update:visible":function(e){t.dialogTime=e}}},[a("el-button",{staticClass:"margin-bottom__small",attrs:{type:"primary"},on:{click:t.addDaoPai}},[t._v("添加")]),t._v(" "),a("el-table",{staticClass:"margin-bottom__small",staticStyle:{width:"100%"},attrs:{border:"",stripe:"",data:t.daopaiList}},[a("el-table-column",{attrs:{label:"倒排工作项",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-input",{model:{value:s.name,callback:function(e){t.$set(s,"name",e)},expression:"row.name"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"倒排时间节点",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"timestamp",placeholder:"选择日期"},model:{value:s.time,callback:function(e){t.$set(s,"time",e)},expression:"row.time"}})]}}])})],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.saveDaopai}},[t._v("提交")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogTime=!1}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]};var i=a("VU/8")(n,l,!1,function(t){a("FLce")},null,null);e.default=i.exports},FLce:function(t,e){}});
//# sourceMappingURL=21.7087f9b46fd1471bd13c.js.map