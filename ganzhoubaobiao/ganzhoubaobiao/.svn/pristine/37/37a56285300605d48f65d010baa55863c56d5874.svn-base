webpackJsonp([26],{"6mtw":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("3cXf"),s=a.n(r),l={data:function(){return{id:sessionStorage.getItem("ViewEditID"),options:[],title:"",tableData:[]}},filters:{handlerUpperCase:function(t){if(""===t)return"";for(var e=t.toString(),a="",r=e.length-1;r>=0;r--){if(e.length>4)return"";var s="";switch(e.charAt(r)){case"0":s="零"+s;break;case"1":s="一"+s;break;case"2":s="二"+s;break;case"3":s="三"+s;break;case"4":s="四"+s;break;case"5":s="五"+s;break;case"6":s="六"+s;break;case"7":s="七"+s;break;case"8":s="八"+s;break;case"9":s="九"+s}switch(e.length-r-1){case 0:s=s;break;case 1:0!=s&&(s+="十");break;case 2:0!=s&&(s+="百");break;case 3:0!=s&&(s+="千")}a=s+a}for(;-1!=a.search("零零");)a=a.replace("零零","零");return 0===a.indexOf("一十")&&(a=a.substr(1)),a.lastIndexOf("零")===a.length-1&&(a=a.substr(0,a.length-1)),a+"、"}},computed:{totalMoney:function(){return JSON.parse(s()(this.tableData)).map(function(t){return t.cost}).reduce(function(t,e){return parseInt(t)+parseInt(e)},0)}},mounted:function(){var t=this;this.$nextTick(function(){t.getSpanArr(t.tableData),t.id&&t.queryAllProcedureById()})},methods:{getSpanArr:function(t){this._spanArr=[];for(var e=0;e<t.length;e++)0===e?(this._spanArr.push(1),this._pos=0):t[e].id===t[e-1].id?(this._spanArr[this._pos]+=1,this._spanArr.push(0)):(this._spanArr.push(1),this._pos=e)},arraySpanMethod:function(t){var e=t.row,a=(t.column,t.rowIndex),r=t.columnIndex;if(!this.tableData.length)return[1,1];if(0===r){var s=this._spanArr[a];return{rowspan:s,colspan:s>0?e.hasChild?1:2:0}}return 1!==r||e.isChild||e.hasChild?void 0:[1,0]},addItem:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],{order:"",procedure:"",childProcedure:"",name:"",material:"",timeLimit:"",cost:"",remarks:"",isChild:!1,hasChild:!1});if(1===t){void 0===this._ids&&(this._ids=999),a.id=this._ids++;var r=[];this.tableData.forEach(function(t){r.some(function(e){return e==t.id})||r.push(t.id)}),a.order=r.length+1,this.tableData.push(a)}if(2===t){a.id=e.id,a.isChild=!0,e.hasChild=!0;var s=this.getAllSame(e);this.tableData.splice(s[s.length-1]+1,0,a)}this.getSpanArr(this.tableData)},deleteItem:function(t,e){if(t.isChild){var a=this.tableData[e-1];a.hasChild&&(a.hasChild=!1),this.tableData.splice(e,1)}else{var r=this.getAllSame(t);this.tableData.splice(r[0],r.length)}this.getSpanArr(this.tableData)},getAllSame:function(t){var e=[];return this.tableData.forEach(function(a,r){a.id===t.id&&e.push(r)}),e},finishSave:function(){var t=this;return this.title?this.tableData.length<1?this.$message({showClose:!0,type:"error",message:"请添加程序流程后再执行保存操作！"}):void this.$post("/web/createProcedure",{procedure:s()(this.tableData),name:this.title,id:this.id}).then(function(e){-1==e.resultCode?t.$message({showClose:!0,type:"warning",message:e.resultDesc}):(t.$message({showClose:!0,type:"success",message:"操作成功！"}),t.$router.push({path:"/ProgramFlow"}))}):this.$message({showClose:!0,type:"error",message:"请输入项目类型标题！"})},queryAllProcedureById:function(){var t=this;this.$post("/admin/queryAllProcedureById",{id:this.id}).then(function(e){t.title=e.content.name;var a=e.content.procedureList;t.tableData=[];var r="",s=1;a.forEach(function(e,a){var l={};e.pid?(l.id=r,l.procedure=e.name,l.childProcedure=e.aliasName,l.name=e.department,l.material=e.material,l.timeLimit=e.timeLimit,l.cost=e.cost,l.order="",l.remarks=e.remark,l.hasChild=!1,l.isChild=!0,t.tableData.push(l)):(r=e.id,l.id=e.id,l.procedure=e.name,l.childProcedure=e.aliasName,l.name=e.department,l.material=e.material,l.timeLimit=e.timeLimit,l.cost=e.cost,l.order=s++,l.remarks=e.remark,l.hasChild=!0,l.isChild=!1,t.tableData.push(l))}),t.getSpanArr(t.tableData)})}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"program-flow__add"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"项目类型标题"}},[a("el-input",{model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1)],1)],1),t._v(" "),a("el-col",{staticClass:"text-right",attrs:{span:4,offset:8}},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addItem(1)}}},[t._v("添加项")])],1)],1),t._v(" "),a("el-table",{staticClass:"display-second-th margin-bottom__small",staticStyle:{width:"100%"},attrs:{data:t.tableData,height:"500","span-method":t.arraySpanMethod}},[a("el-table-column",{attrs:{label:"办理程序",align:"center","min-width":"130"}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("div",{staticClass:"number-order__wrape"},[a("label",{staticClass:"number-order__label"},[t._v(t._s(t._f("handlerUpperCase")(r.order)))]),t._v(" "),a("div",{staticClass:"number-order__content"},[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"办理程序",autosize:{minRows:4}},model:{value:r.procedure,callback:function(e){t.$set(r,"procedure",e)},expression:"row.procedure"}})],1)])]}}])}),t._v(" "),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"办理程序",autosize:""},model:{value:r.childProcedure,callback:function(e){t.$set(r,"childProcedure",e)},expression:"row.childProcedure"}})]}}])})],1),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"办理部门"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"办理部门",autosize:""},model:{value:r.name,callback:function(e){t.$set(r,"name",e)},expression:"row.name"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"需提交的材料"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"材料",autosize:""},model:{value:r.material,callback:function(e){t.$set(r,"material",e)},expression:"row.material"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"办理的工作时限（工作日）"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"时限",autosize:""},model:{value:r.timeLimit,callback:function(e){t.$set(r,"timeLimit",e)},expression:"row.timeLimit"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"报建费用（每平方米）"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input-number",{staticStyle:{width:"100%"},attrs:{controls:!1,min:0},model:{value:r.cost,callback:function(e){t.$set(r,"cost",e)},expression:"row.cost"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"备注",autosize:""},model:{value:r.remarks,callback:function(e){t.$set(r,"remarks",e)},expression:"row.remarks"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row,s=e.$index;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"向上移动",placement:"top-start"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-sort-up"}})],1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"向下移动",placement:"top-start"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-sort-down"}})],1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"添加子项",placement:"top-start"}},[r.isChild?t._e():a("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(e){return t.addItem(2,r,s)}}})],1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(e){return t.deleteItem(r,s)}}})],1)]}}])})],1),t._v(" "),a("div",{staticClass:"program-flow__footer clearfix"},[a("span",[t._v("测算本县（市）建设费用："),a("span",{staticClass:"money-hint"},[t._v(t._s(t.totalMoney))]),t._v("元每平方米")]),t._v(" "),a("div",{staticClass:"pull-right"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:t.finishSave}},[t._v("确定")]),t._v(" "),a("el-button",{on:{click:function(e){return t.$router.push({path:"/ProgramFlow"})}}},[t._v("取消")])],1)])],1)},staticRenderFns:[]};var n=a("C7Lr")(l,i,!1,function(t){a("i5hF")},null,null);e.default=n.exports},i5hF:function(t,e){}});
//# sourceMappingURL=26.b69f0deefc90adf2e56f.js.map