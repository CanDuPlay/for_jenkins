webpackJsonp([7],{UTdL:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("3cXf"),i=s.n(a),o=s("WJGH"),n=s("1/Ac"),l=["#fee9e9","#e1f5fe","#e8f6ed"],r={data:function(){return{value:"",projectStage:"",options:[],tableData:[],editId:sessionStorage.getItem("EditCityProjectID"),county:o.b,forms:{name:"",startTime:"",endTime:"",contacts:"",invest:"",procedureType:"",projectData:"",townData:""},townList:[],checkTownList:[],projectTownList:[],procedureList:[]}},created:function(){this.findProcedureList()},mounted:function(){var e=this;this.$nextTick(function(){e.editId&&e.queryProjectById(),e.queryTownInfo(e.editId),e.getSpanArr(o.a),e.tableData=JSON.parse(i()(o.a)),e.editId||e.tableData.forEach(function(e,t){e.selectValue="",e.flowPath=[]})})},methods:{queryProjectById:function(){var e=this;this.$post("/admin/queryProjectById",{id:this.editId}).then(function(t){var s=t.content.tProject,a=[];t.content.tProjectStageList.forEach(function(e,t){var s={};s.id=e.id,s.type=t++,s.name=e.name,s.isDao=e.isDaopai,s.plan=e.plan,s.selectValue=e.selectValue,a.push(s)}),e.getSpanArr(a),e.forms=s,e.tableData=a,e.changeProcedure(s.procedureType)})},getSpanArr:function(e){this._spanArr=[];for(var t=0;t<e.length;t++)0===t?(this._spanArr.push(1),this._pos=0):e[t].id===e[t-1].id?(this._spanArr[this._pos]+=1,this._spanArr.push(0)):(this._spanArr.push(1),this._pos=t)},arraySpanMethod:function(e){var t=e.row,s=(e.column,e.rowIndex),a=e.columnIndex;if(0===a){var i=this._spanArr[s];return{rowspan:i,colspan:i>0?1:0}}return 2===a&&(t.isAdd||t.isEdit)?{rowspan:1,colspan:0}:3===a&&(t.isAdd||t.isEdit)?{rowspan:1,colspan:2}:void 0},setCellStyle:function(e){e.row,e.column,e.rowIndex;return 0===e.columnIndex?(void 0===this._index?this._index=0:this._index++,{backgroundColor:l[this._index%3],fontSize:"18px"}):{color:"#606266"}},addPlan:function(e,t){if(""===e.plan)return this.$message({showClose:!0,message:"请输入进度名称！",type:"error"});if(e.isEdit)return e.isEdit=!1;var s=JSON.parse(i()(e));s.isAdd=!1,this.tableData.splice(t,0,s),this.getSpanArr(this.tableData),e.plan="",e.selectValue=null,e.flowPath=this.procedureList},delPlan:function(e,t){this.tableData.splice(t,1),this.getSpanArr(this.tableData)},planEdit:function(e){e.isEdit||(e.isEdit=!0)},planSort:function(e,t,s){if("up"===s){if(t-1>=0&&this.tableData[t].id!==this.tableData[t-1].id||0===t)return;this.tableData.splice(t,1),this.tableData.splice(t-1,0,e)}else{if(this.tableData.length>t+1&&!!this.tableData[t+1].isAdd)return;this.tableData.splice(t,1),this.tableData.splice(t+1,0,e)}},closeEdit:function(e){e.isEdit?e.isEdit=!1:(e.plan="",e.selectValue="")},handlerCheckbox:function(e){var t=this;1===e&&this.townList.forEach(function(e){void 0===e.isChecked?t.$set(e,"isChecked",!0):e.isChecked=!0}),2===e&&this.townList.forEach(function(e){void 0===e.isChecked?t.$set(e,"isChecked",!1):e.isChecked=!1}),3===e&&this.townList.forEach(function(e){void 0===e.isChecked?t.$set(e,"isChecked",!0):e.isChecked=!e.isChecked})},changeProcedure:function(e){var t=this;this.$post("/admin/queryAllProcedureById",{id:e}).then(function(e){e.content.procedureList.forEach(function(e,s){var a={};a.label=e.name,a.id=e.id,t.procedureList.push(a)}),t.tableData.forEach(function(e,s){e.flowPath=t.procedureList})})},saveProjectStage:function(){if(!this.projectStage)return this.$message({showClose:!0,type:"error",message:"请输入阶段名称！"});if(!this.forms.procedureType)return this.$message({showClose:!0,type:"error",message:"请先选择程序流程！"});var e={id:2222,type:4};e.name=this.projectStage,e.plan="",e.isAdd=!0,e.flowPath=this.procedureList,this.tableData.splice(this.tableData.length,0,e),this.getSpanArr(this.tableData),this.projectStage=""},queryTownInfo:function(e){var t=this;this.$post("/web/queryTownInfo",{projectId:e}).then(function(e){t.townList=e.content.tDictionaryList,t.projectTownList=e.content.tProjectTownList,t.townList.forEach(function(e,s){t.$set(e,"danwei",""),t.$set(e,"lingdao",""),t.$set(e,"isChecked",!1),t.projectTownList.forEach(function(t){t.townId==e.code&&(e.isChecked=!0,t.accountabilityUnit&&(e.danwei=t.accountabilityUnit),t.contacts&&(e.lingdao=t.contacts))})})})},findProcedureList:function(){var e=this;this.$post("/web/findProcedureList").then(function(t){e.options=t.content.tProcedureTypeList})},validStartTime:function(e){if(this.forms.endTime&&e&&this.forms.endTime<e.getTime())return this.$message({showClose:!0,type:"warning",message:"竣工时间应大于开工时间！"}),this.forms.endTime="",!1},validEndTime:function(e){if(this.forms.startTime&&e&&this.forms.startTime>e.getTime())return this.$message({showClose:!0,type:"warning",message:"开工时间应小于竣工时间！"}),this.forms.startTime="",!1},finalSave:function(){var e=this;if(!this.forms.name)return this.$message({showClose:!0,type:"error",message:"请输入项目名称！"}),!1;if(!this.forms.startTime)return this.$message({showClose:!0,type:"error",message:"请选择开工日期！"}),!1;if(!this.forms.endTime)return this.$message({showClose:!0,type:"error",message:"请选择竣工日期！"}),!1;if(!this.forms.contacts)return this.$message({showClose:!0,type:"error",message:"请输入总负责人！"}),!1;if(!this.forms.invest)return this.$message({showClose:!0,type:"error",message:"请输入规划总投资！"}),!1;if(!/^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$/.test(this.forms.invest))return this.$message({showClose:!0,type:"error",message:"规划总投资只能为数字格式！"}),!1;if(!this.forms.procedureType)return this.$message({showClose:!0,type:"error",message:"请选择程序流程！"}),!1;this.forms.projectData=this.tableData,this.forms.startTime=Object(n.b)(new Date(this.forms.startTime),"YYYY-MM-DD HH:mm:ss"),this.forms.endTime=Object(n.b)(new Date(this.forms.endTime),"YYYY-MM-DD HH:mm:ss");for(var t=0;t<this.townList.length;t++)if(this.townList[t].isChecked){if(!this.townList[t].danwei)return this.$message({showClose:!0,type:"error",message:"请输入责任单位！"}),!1;if(!this.townList[t].lingdao)return this.$message({showClose:!0,type:"error",message:"请输入定点联系领导！"}),!1;delete this.townList[t].townType,this.checkTownList.push(this.townList[t])}this.forms.townData=this.checkTownList;this.forms;this.$post("/admin/createProject",{project:i()(this.forms)}).then(function(t){0==t.resultCode?(e.$message({showClose:!0,type:"success",message:"操作成功！"}),e.tableData=[],e.$router.push({name:"CityProject"})):-1==t.resultCode&&e.$message({showClose:!0,type:"warning",message:t.resultDesc})})},cancelSave:function(){this.tableData=[],this.$router.push({path:"/CityProject"})}}},c={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"city-add__wrapper plate"},[s("div",{staticClass:"plate-bottom has-padding has-radius margin-bottom__small"},[s("el-row",{attrs:{gutter:18}},[s("el-col",{attrs:{span:14}},[s("el-form",{attrs:{"label-width":"85px"}},[s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"项目名称"}},[s("el-input",{attrs:{placeholder:"项目名称",maxlength:"300",onKeypress:"javascript:if(event.keyCode == 32)event.returnValue = false;"},model:{value:e.forms.name,callback:function(t){e.$set(e.forms,"name",t)},expression:"forms.name"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"开工日期"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"开工日期"},on:{change:e.validStartTime},model:{value:e.forms.startTime,callback:function(t){e.$set(e.forms,"startTime",t)},expression:"forms.startTime"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"竣工日期"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"竣工日期"},on:{change:e.validEndTime},model:{value:e.forms.endTime,callback:function(t){e.$set(e.forms,"endTime",t)},expression:"forms.endTime"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"总负责人"}},[s("el-input",{attrs:{placeholder:"总负责人",maxlength:"20"},model:{value:e.forms.contacts,callback:function(t){e.$set(e.forms,"contacts",t)},expression:"forms.contacts"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"规划总投资"}},[s("el-input",{attrs:{placeholder:"规划总投资"},model:{value:e.forms.invest,callback:function(t){e.$set(e.forms,"invest",t)},expression:"forms.invest"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"程序流程"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"程序流程"},on:{change:e.changeProcedure},model:{value:e.forms.procedureType,callback:function(t){e.$set(e.forms,"procedureType",t)},expression:"forms.procedureType"}},e._l(e.options,function(e,t){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1)],1),e._v(" "),s("el-table",{staticClass:"margin-bottom__small",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"cell-style":e.setCellStyle,"header-cell-style":{backgroundColor:"#e1f5fe"},"span-method":e.arraySpanMethod}},[s("el-table-column",{attrs:{resizable:!1,label:"阶段",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("div",{staticClass:"margin-bottom__small"},[s("el-input",{model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"row.name"}})],1),e._v(" "),s("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:a.isDao,callback:function(t){e.$set(a,"isDao",t)},expression:"row.isDao"}},[e._v("允许设置倒排时间")])]}}])}),e._v(" "),s("el-table-column",{attrs:{resizable:!1,label:"进度",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[a.isAdd||a.isEdit?s("el-input",{attrs:{placeholder:"进度"},model:{value:a.plan,callback:function(t){e.$set(a,"plan",t)},expression:"row.plan"}}):s("span",[e._v(e._s(a.plan))])]}}])}),e._v(" "),s("el-table-column",{attrs:{resizable:!1,label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,i=t.$index;return[a.isAdd&&a.isEdit?e._e():s("div",[s("i",{staticClass:"operation-icon__btn el-icon-sort-up",on:{click:function(t){return e.planSort(a,i,"up")}}}),e._v(" "),s("i",{staticClass:"operation-icon__btn el-icon-sort-down",on:{click:function(t){return e.planSort(a,i,"down")}}}),e._v(" "),s("i",{staticClass:"operation-icon__btn el-icon-edit",on:{click:function(t){return e.planEdit(a)}}}),e._v(" "),s("i",{staticClass:"operation-icon__btn el-icon-circle-close-outline",on:{click:function(t){return e.delPlan(a,i)}}})])]}}])}),e._v(" "),s("el-table-column",{attrs:{resizable:!1,label:"程序流程"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,i=t.$index;return[s("el-select",{style:{width:a.isAdd||a.isEdit?"75%":"100%"},attrs:{placeholder:"程序流程"},model:{value:a.selectValue,callback:function(t){e.$set(a,"selectValue",t)},expression:"row.selectValue"}},e._l(a.flowPath,function(e){return s("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}),1),e._v(" "),a.isAdd||a.isEdit?s("div",{staticClass:"procedure-operation"},[s("i",{staticClass:"el-icon-circle-close cursor",on:{click:function(t){return e.closeEdit(a)}}}),e._v(" "),s("i",{staticClass:"el-icon-circle-check cursor",on:{click:function(t){return e.addPlan(a,i)}}})]):e._e()]}}])})],1),e._v(" "),s("el-form",[s("el-form-item",{attrs:{label:"增加阶段"}},[s("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"阶段"},model:{value:e.projectStage,callback:function(t){e.projectStage=t},expression:"projectStage"}}),e._v(" "),s("el-button",{attrs:{type:"primary",plain:""},on:{click:e.saveProjectStage}},[e._v("确定")])],1)],1)],1),e._v(" "),s("el-col",{attrs:{span:10}},[s("div",{staticClass:"right-wrapper"},[s("section",{staticClass:"title-bar clearfix margin-bottom__small"},[s("span",{staticClass:"titles"},[e._v("区县范围")]),e._v(" "),s("div",{staticClass:"pull-right"},[s("el-button",{on:{click:function(t){return e.handlerCheckbox(1)}}},[e._v("全选")]),e._v(" "),s("el-button",{on:{click:function(t){return e.handlerCheckbox(2)}}},[e._v("取消")]),e._v(" "),s("el-button",{on:{click:function(t){return e.handlerCheckbox(3)}}},[e._v("反选")])],1)]),e._v(" "),s("el-table",{staticClass:"tabel-normal",staticStyle:{width:"100%"},attrs:{data:e.townList}},[s("el-table-column",{attrs:{width:"40"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-checkbox",{model:{value:a.isChecked,callback:function(t){e.$set(a,"isChecked",t)},expression:"row.isChecked"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"区县名称",prop:"name",width:"80"}}),e._v(" "),s("el-table-column",{attrs:{label:"责任单位"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-input",{attrs:{disabled:!a.isChecked},model:{value:a.danwei,callback:function(t){e.$set(a,"danwei",t)},expression:"row.danwei"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"市教育局定点联系领导"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-input",{attrs:{disabled:!a.isChecked},model:{value:a.lingdao,callback:function(t){e.$set(a,"lingdao",t)},expression:"row.lingdao"}})]}}])})],1)],1)])],1)],1),e._v(" "),s("div",{staticClass:"text-right"},[s("el-button",{attrs:{type:"primary"},on:{click:e.finalSave}},[e._v("确定")]),e._v(" "),s("el-button",{on:{click:e.cancelSave}},[e._v("取消")])],1)])},staticRenderFns:[]};var d=s("C7Lr")(r,c,!1,function(e){s("qK7C")},null,null);t.default=d.exports},WJGH:function(e,t,s){"use strict";s.d(t,"c",function(){return a}),s.d(t,"a",function(){return i}),s.d(t,"b",function(){return o});var a=[{id:1,type:1,state:!1,jd:"未开工",gj:"征地",zt:1,je:"1000",jh:1,time:"2018年8月——2018年9月",color:"#fee9e9"},{id:1,type:1,state:!0,jd:"未开工",gj:"设计",zt:1,je:"1000",jh:1,time:"2018年8月——2018年9月",color:"#fee9e9"},{id:1,type:1,jd:"未开工",gj:"图审",zt:2,je:"1000",jh:2,time:"2018年8月——2018年9月",color:"#fee9e9"},{id:2,type:2,state:!1,jd:"开工进行中",gj:"主体开工",zt:2,je:"1000",jh:2,time:"2018年8月——2018年9月",color:"#e1f5fe"},{id:2,type:2,state:!1,jd:"开工进行中",gj:"装修",zt:2,je:"1000",jh:2,time:"2018年8月——2018年9月",color:"#e1f5fe"},{id:3,type:3,state:!1,jd:"投入使用",gj:"投入使用",zt:2,je:"1000",jh:2,time:"2018年8月——2018年9月",color:"#e8f6ed"}],i=[{id:13,type:1,name:"未开工",isDao:1,plan:"征地",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:13,type:1,name:"未开工",isDao:1,plan:"设计",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:13,type:1,name:"未开工",isDao:1,plan:"图审",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:13,type:1,name:"未开工",isDao:1,plan:"",isAdd:!0,flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:133,type:2,name:"进行中",isDao:1,plan:"主体开工",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:133,type:2,name:"进行中",isDao:1,plan:"装修",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:133,type:2,name:"进行中",isDao:1,plan:"",isAdd:!0,flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:1332,type:3,name:"投入使用",isDao:1,plan:"投入使用",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:1332,type:3,name:"投入使用",isDao:1,plan:"",isAdd:!0,flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]}],o=[{id:1,name:"章贡区",danwei:"",lingdao:""},{id:2,name:"南康区",danwei:"",lingdao:""},{id:3,name:"赣县区",danwei:"",lingdao:""},{id:4,name:"信丰区",danwei:"",lingdao:""}]},qK7C:function(e,t){}});
//# sourceMappingURL=7.b8f1164a98be395304bf.js.map