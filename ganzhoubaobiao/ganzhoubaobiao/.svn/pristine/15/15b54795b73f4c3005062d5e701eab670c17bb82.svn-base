webpackJsonp([19],{"6mtw":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),s=a.n(r),i={data:function(){return{id:sessionStorage.getItem("ViewEditID"),options:[],title:"",tableData:[]}},filters:{handlerUpperCase:function(e){if(""===e)return"";for(var t=e.toString(),a="",r=t.length-1;r>=0;r--){if(t.length>4)return"";var s="";switch(t.charAt(r)){case"0":s="零"+s;break;case"1":s="一"+s;break;case"2":s="二"+s;break;case"3":s="三"+s;break;case"4":s="四"+s;break;case"5":s="五"+s;break;case"6":s="六"+s;break;case"7":s="七"+s;break;case"8":s="八"+s;break;case"9":s="九"+s}switch(t.length-r-1){case 0:s=s;break;case 1:0!=s&&(s+="十");break;case 2:0!=s&&(s+="百");break;case 3:0!=s&&(s+="千")}a=s+a}for(;-1!=a.search("零零");)a=a.replace("零零","零");return 0===a.indexOf("一十")&&(a=a.substr(1)),a.lastIndexOf("零")===a.length-1&&(a=a.substr(0,a.length-1)),a+"、"}},computed:{totalMoney:function(){return JSON.parse(s()(this.tableData)).map(function(e){return e.cost}).reduce(function(e,t){return parseInt(e)+parseInt(t)},0)}},mounted:function(){var e=this;this.$nextTick(function(){e.getSpanArr(e.tableData),e.id&&e.queryAllProcedureById()})},methods:{tableRenderHeader:function(e,t){var a=t.column,r=(t.$index,a.label.indexOf(" ")),s=a.label.slice(0,r),i=a.label.slice(r);return e("section",[e("p",s),e("p",i)])},getSpanArr:function(e){this._spanArr=[];for(var t=0;t<e.length;t++)0===t?(this._spanArr.push(1),this._pos=0):e[t].id===e[t-1].id?(this._spanArr[this._pos]+=1,this._spanArr.push(0)):(this._spanArr.push(1),this._pos=t)},arraySpanMethod:function(e){var t=e.row,a=(e.column,e.rowIndex),r=e.columnIndex;if(!this.tableData.length)return[1,1];if(0===r){var s=this._spanArr[a];return{rowspan:s,colspan:s>0?t.hasChild?1:2:0}}return 1!==r||t.isChild||t.hasChild?void 0:[1,0]},addItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],{order:"",procedure:"",childProcedure:"",name:"",material:"",timeLimit:"",cost:"",remarks:"",isChild:!1,hasChild:!1});if(1===e){void 0===this._ids&&(this._ids=999),a.id=this._ids++;var r=[];this.tableData.forEach(function(e){r.some(function(t){return t==e.id})||r.push(e.id)}),a.order=r.length+1,this.tableData.push(a)}if(2===e){a.id=t.id,a.isChild=!0,t.hasChild=!0;var s=this.getAllSame(t);this.tableData.splice(s[s.length-1]+1,0,a)}this.getSpanArr(this.tableData)},deleteItem:function(e,t){if(e.isChild){var a=this.tableData[t-1];a.hasChild&&(a.hasChild=!1),this.tableData.splice(t,1)}else{var r=this.getAllSame(e);this.tableData.splice(r[0],r.length)}this.getSpanArr(this.tableData)},getAllSame:function(e){var t=[];return this.tableData.forEach(function(a,r){a.id===e.id&&t.push(r)}),t},finishSave:function(){var e=this;if(!this.title)return this.$message({showClose:!0,type:"error",message:"请输入项目类型标题！"});if(this.tableData.length<1)return this.$message({showClose:!0,type:"error",message:"请添加程序流程后再执行保存操作！"});for(var t=0;t<this.tableData.length;t++){var a=this.tableData[t];if(!a.procedure&&!a.childProcedure)return this.$message({showClose:!0,type:"error",message:"请输入办理程序！"});if(!a.name)return this.$message({showClose:!0,type:"error",message:"请输入办理部门！"});if(!a.material)return this.$message({showClose:!0,type:"error",message:"请输入需提交的材料！"});if(!a.timeLimit)return this.$message({showClose:!0,type:"error",message:"请输入办理的工作时限！"});if(!a.cost)return this.$message({showClose:!0,type:"error",message:"请输入报建费用！"});if(!/^[+]{0,1}(\d+)$|^[+]{0,1}(\d+\.\d+)$/.test(a.cost))return this.$message({showClose:!0,type:"error",message:"报建费用只能为数字支持两位小数！"})}this.$post("/web/createProcedure",{procedure:s()(this.tableData),name:this.title,id:this.id}).then(function(t){-1==t.resultCode?e.$message({showClose:!0,type:"warning",message:t.resultDesc}):(e.$message({showClose:!0,type:"success",message:"操作成功！"}),e.$router.push({path:"/ProgramFlow"}))})},queryAllProcedureById:function(){var e=this;this.$post("/admin/queryAllProcedureById",{id:this.id}).then(function(t){e.title=t.content.name;var a=t.content.procedureList;e.tableData=[];var r="",s=1;a.forEach(function(t,i){var l={};t.pid?(l.id=r,l.procedure=t.name,l.childProcedure=t.aliasName,l.name=t.department,l.material=t.material,l.timeLimit=t.timeLimit,l.cost=t.cost,l.order="",l.remarks=t.remark,l.hasChild=!1,l.isChild=!0,e.tableData.push(l)):(r=t.id,l.id=t.id,l.procedure=t.name,l.childProcedure=t.aliasName,l.name=t.department,l.material=t.material,l.timeLimit=t.timeLimit,l.cost=t.cost,l.order=s++,l.remarks=t.remark,l.hasChild=a.some(function(e){return e.pid==t.id}),l.isChild=!1,e.tableData.push(l))}),e.getSpanArr(e.tableData)})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"program-flow__add"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"项目类型标题"}},[a("el-input",{model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1)],1),e._v(" "),a("el-col",{staticClass:"text-right",attrs:{span:4,offset:8}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addItem(1)}}},[e._v("添加项")])],1)],1),e._v(" "),a("el-table",{staticClass:"display-second-th margin-bottom__small",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"500","span-method":e.arraySpanMethod}},[a("el-table-column",{attrs:{label:"办理程序",align:"center"}},[a("el-table-column",{attrs:{width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",{staticClass:"number-order__wrape"},[a("label",{staticClass:"number-order__label"},[e._v(e._s(e._f("handlerUpperCase")(r.order)))]),e._v(" "),a("div",{staticClass:"number-order__content"},[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"办理程序",autosize:{minRows:4}},model:{value:r.procedure,callback:function(t){e.$set(r,"procedure",t)},expression:"row.procedure"}})],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"办理程序",autosize:""},model:{value:r.childProcedure,callback:function(t){e.$set(r,"childProcedure",t)},expression:"row.childProcedure"}})]}}])})],1),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"办理部门",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"办理部门",autosize:""},model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"row.name"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"需提交的材料",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"材料",autosize:""},model:{value:r.material,callback:function(t){e.$set(r,"material",t)},expression:"row.material"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"办理的工作时限 （工作日）",width:"120","render-header":e.tableRenderHeader},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input-number",{staticStyle:{width:"100%"},attrs:{controls:!1,min:0},model:{value:r.timeLimit,callback:function(t){e.$set(r,"timeLimit",t)},expression:"row.timeLimit"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"报建费用 （元每平方米）",width:"120","render-header":e.tableRenderHeader},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input-number",{staticStyle:{width:"100%"},attrs:{controls:!1,min:0},model:{value:r.cost,callback:function(t){e.$set(r,"cost",t)},expression:"row.cost"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"备注",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticClass:"default-textarea",attrs:{type:"textarea",placeholder:"备注",autosize:""},model:{value:r.remarks,callback:function(t){e.$set(r,"remarks",t)},expression:"row.remarks"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,s=t.$index;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"添加子项",placement:"top-start"}},[r.isChild?e._e():a("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(t){return e.addItem(2,r,s)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.deleteItem(r,s)}}})],1)]}}])})],1),e._v(" "),a("div",{staticClass:"program-flow__footer clearfix"},[a("span",[e._v("测算本县（市）建设费用："),a("span",{staticClass:"money-hint"},[e._v(e._s(e.totalMoney))]),e._v("元每平方米")]),e._v(" "),a("div",{staticClass:"pull-right"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.finishSave}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:function(t){return e.$router.push({path:"/ProgramFlow"})}}},[e._v("取消")])],1)])],1)},staticRenderFns:[]};var n=a("C7Lr")(i,l,!1,function(e){a("Oc0s")},null,null);t.default=n.exports},Oc0s:function(e,t){}});
//# sourceMappingURL=19.7c0a47f9ad09919c5b6a.js.map