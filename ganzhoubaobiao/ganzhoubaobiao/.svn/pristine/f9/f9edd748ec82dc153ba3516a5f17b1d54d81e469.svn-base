webpackJsonp([8],{UTdL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("3cXf"),i=a.n(s),n=a("WJGH"),o=a("1/Ac"),l=["#fee9e9","#e1f5fe","#e8f6ed"],r={data:function(){return{value:"",projectStage:"",options:[],tableData:[],editId:sessionStorage.getItem("EditCityProjectID"),county:n.b,forms:{name:"",startTime:"",endTime:"",contacts:"",invest:"",procedureType:"",projectData:"",townData:""},townList:[],checkTownList:[],projectTownList:[],procedureList:[]}},created:function(){this.findProcedureList()},mounted:function(){var e=this;this.$nextTick(function(){e.editId&&e.queryProjectById(),e.queryTownInfo(e.editId),e.getSpanArr(n.a),e.tableData=JSON.parse(i()(n.a)),e.editId||e.tableData.forEach(function(e,t){e.selectValue="",e.flowPath=[]})})},methods:{queryProjectById:function(){var e=this;this.$post("/admin/queryProjectById",{id:this.editId}).then(function(t){var a=t.content.tProject,s=[];t.content.tProjectStageList.forEach(function(e,t){var a={};a.id=e.id,a.type=t++,a.name=e.name,a.isDao=e.isDaopai,a.plan=e.plan,a.selectValue=e.selectValue,s.push(a)}),e.getSpanArr(s),e.forms=a,e.tableData=s,e.changeProcedure(a.procedureType)})},getSpanArr:function(e){this._spanArr=[];for(var t=0;t<e.length;t++)0===t?(this._spanArr.push(1),this._pos=0):e[t].id===e[t-1].id?(this._spanArr[this._pos]+=1,this._spanArr.push(0)):(this._spanArr.push(1),this._pos=t)},arraySpanMethod:function(e){var t=e.row,a=(e.column,e.rowIndex),s=e.columnIndex;if(0===s){var i=this._spanArr[a];return{rowspan:i,colspan:i>0?1:0}}return 2===s&&(t.isAdd||t.isEdit)?{rowspan:1,colspan:0}:3===s&&(t.isAdd||t.isEdit)?{rowspan:1,colspan:2}:void 0},setCellStyle:function(e){e.row,e.column,e.rowIndex;return 0===e.columnIndex?(void 0===this._index?this._index=0:this._index++,{backgroundColor:l[this._index%3],fontSize:"18px"}):{color:"#606266"}},addPlan:function(e,t){if(""===e.plan)return this.$message({showClose:!0,message:"请输入进度名称！",type:"error"});if(e.isEdit)return e.isEdit=!1;var a=JSON.parse(i()(e));a.isAdd=!1,this.tableData.splice(t,0,a),this.getSpanArr(this.tableData),e.plan="",e.selectValue=null,e.flowPath=this.procedureList},delPlan:function(e,t){this.tableData.splice(t,1),this.getSpanArr(this.tableData)},planEdit:function(e){e.isEdit||(e.isEdit=!0)},planSort:function(e,t,a){if("up"===a){if(t-1>=0&&this.tableData[t].id!==this.tableData[t-1].id||0===t)return;this.tableData.splice(t,1),this.tableData.splice(t-1,0,e)}else{if(this.tableData.length>t+1&&!!this.tableData[t+1].isAdd)return;this.tableData.splice(t,1),this.tableData.splice(t+1,0,e)}},closeEdit:function(e){e.isEdit?e.isEdit=!1:(e.plan="",e.selectValue="")},handlerCheckbox:function(e){var t=this;1===e&&this.townList.forEach(function(e){void 0===e.isChecked?t.$set(e,"isChecked",!0):e.isChecked=!0}),2===e&&this.townList.forEach(function(e){void 0===e.isChecked?t.$set(e,"isChecked",!1):e.isChecked=!1}),3===e&&this.townList.forEach(function(e){void 0===e.isChecked?t.$set(e,"isChecked",!0):e.isChecked=!e.isChecked})},changeProcedure:function(e){var t=this;this.$post("/admin/queryAllProcedureById",{id:e}).then(function(e){var a=e.content.procedureList;t.procedureList=[],a.forEach(function(e,a){var s={};s.label=null==e.pid?e.name:""+e.aliasName,s.id=e.id,t.procedureList.push(s)}),t.tableData.forEach(function(e,a){e.flowPath=t.procedureList})})},saveProjectStage:function(){if(!this.projectStage)return this.$message({showClose:!0,type:"error",message:"请输入阶段名称！"});if(!this.forms.procedureType)return this.$message({showClose:!0,type:"error",message:"请先选择程序流程！"});var e={id:2222,type:4};e.name=this.projectStage,e.plan="",e.isAdd=!0,e.flowPath=this.procedureList,this.tableData.splice(this.tableData.length,0,e),this.getSpanArr(this.tableData),this.projectStage=""},queryTownInfo:function(e){var t=this;this.$post("/web/queryTownInfo",{projectId:e}).then(function(e){t.townList=e.content.tDictionaryList,t.projectTownList=e.content.tProjectTownList,t.townList.forEach(function(e,a){t.$set(e,"danwei",""),t.$set(e,"lingdao",""),t.$set(e,"isChecked",!1),t.projectTownList.forEach(function(t){t.townId==e.code&&(e.isChecked=!0,t.accountabilityUnit&&(e.danwei=t.accountabilityUnit),t.contacts&&(e.lingdao=t.contacts))})})})},findProcedureList:function(){var e=this;this.$post("/web/findProcedureList").then(function(t){e.options=t.content.tProcedureTypeList})},validStartTime:function(e){if(this.forms.endTime&&e&&this.forms.endTime<e.getTime())return this.$message({showClose:!0,type:"warning",message:"竣工时间应大于开工时间！"}),this.forms.endTime="",!1},validEndTime:function(e){if(this.forms.startTime&&e&&this.forms.startTime>e.getTime())return this.$message({showClose:!0,type:"warning",message:"开工时间应小于竣工时间！"}),this.forms.startTime="",!1},changeStageName:function(e){this.tableData.forEach(function(t){t.id==e.id&&(t.name=e.name)})},finalSave:function(){var e=this;if(!this.forms.name)return this.$message({showClose:!0,type:"error",message:"请输入项目名称！"}),!1;if(!this.forms.startTime)return this.$message({showClose:!0,type:"error",message:"请选择开工日期！"}),!1;if(!this.forms.endTime)return this.$message({showClose:!0,type:"error",message:"请选择竣工日期！"}),!1;if(!this.forms.contacts)return this.$message({showClose:!0,type:"error",message:"请输入总负责人！"}),!1;if(!this.forms.invest)return this.$message({showClose:!0,type:"error",message:"请输入规划总投资！"}),!1;if(!/^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$/.test(this.forms.invest))return this.$message({showClose:!0,type:"error",message:"规划总投资只能为数字格式！"}),!1;if(!this.forms.procedureType)return this.$message({showClose:!0,type:"error",message:"请选择程序流程！"}),!1;this.forms.projectData=this.tableData,this.forms.startTime=Object(o.b)(new Date(this.forms.startTime),"YYYY-MM-DD HH:mm:ss"),this.forms.endTime=Object(o.b)(new Date(this.forms.endTime),"YYYY-MM-DD HH:mm:ss");for(var t=0;t<this.townList.length;t++)if(this.townList[t].isChecked){if(!this.townList[t].danwei)return this.$message({showClose:!0,type:"error",message:"请输入责任单位！"}),!1;if(!this.townList[t].lingdao)return this.$message({showClose:!0,type:"error",message:"请输入定点联系领导！"}),!1;delete this.townList[t].townType,this.checkTownList.push(this.townList[t])}this.forms.townData=this.checkTownList;this.forms;this.$post("/admin/createProject",{project:i()(this.forms)}).then(function(t){0==t.resultCode?(e.$message({showClose:!0,type:"success",message:"操作成功！"}),e.tableData=[],e.$router.push({name:"CityProject"})):-1==t.resultCode&&e.$message({showClose:!0,type:"error",message:t.resultDesc})})},cancelSave:function(){this.tableData=[],this.$router.push({path:"/CityProject"})}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"city-add__wrapper plate"},[a("div",{staticClass:"plate-bottom has-padding has-radius margin-bottom__small"},[a("el-row",{attrs:{gutter:18}},[a("el-col",{attrs:{span:14}},[a("el-form",{attrs:{"label-width":"85px"}},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"项目名称"}},[a("el-input",{attrs:{placeholder:"项目名称",maxlength:"300",onKeypress:"javascript:if(event.keyCode == 32)event.returnValue = false;"},model:{value:e.forms.name,callback:function(t){e.$set(e.forms,"name",t)},expression:"forms.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"开工日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"开工日期"},on:{change:e.validStartTime},model:{value:e.forms.startTime,callback:function(t){e.$set(e.forms,"startTime",t)},expression:"forms.startTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"竣工日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"竣工日期"},on:{change:e.validEndTime},model:{value:e.forms.endTime,callback:function(t){e.$set(e.forms,"endTime",t)},expression:"forms.endTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"总负责人"}},[a("el-input",{attrs:{placeholder:"总负责人",maxlength:"20"},model:{value:e.forms.contacts,callback:function(t){e.$set(e.forms,"contacts",t)},expression:"forms.contacts"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"规划总投资"}},[a("el-input",{attrs:{placeholder:"规划总投资"},model:{value:e.forms.invest,callback:function(t){e.$set(e.forms,"invest",t)},expression:"forms.invest"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"程序流程"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"程序流程"},on:{change:e.changeProcedure},model:{value:e.forms.procedureType,callback:function(t){e.$set(e.forms,"procedureType",t)},expression:"forms.procedureType"}},e._l(e.options,function(e,t){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1)],1),e._v(" "),a("el-table",{staticClass:"margin-bottom__small",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"cell-style":e.setCellStyle,"header-cell-style":{backgroundColor:"#e1f5fe"},"span-method":e.arraySpanMethod}},[a("el-table-column",{attrs:{resizable:!1,label:"阶段",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"margin-bottom__small"},[a("el-input",{on:{change:function(t){return e.changeStageName(s)}},model:{value:s.name,callback:function(t){e.$set(s,"name",t)},expression:"row.name"}})],1),e._v(" "),a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:s.isDao,callback:function(t){e.$set(s,"isDao",t)},expression:"row.isDao"}},[e._v("允许设置倒排时间")])]}}])}),e._v(" "),a("el-table-column",{attrs:{resizable:!1,label:"进度",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.isAdd||s.isEdit?a("el-input",{attrs:{placeholder:"进度"},model:{value:s.plan,callback:function(t){e.$set(s,"plan",t)},expression:"row.plan"}}):a("span",[e._v(e._s(s.plan))])]}}])}),e._v(" "),a("el-table-column",{attrs:{resizable:!1,label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,i=t.$index;return[s.isAdd&&s.isEdit?e._e():a("div",[a("i",{staticClass:"operation-icon__btn el-icon-sort-up",on:{click:function(t){return e.planSort(s,i,"up")}}}),e._v(" "),a("i",{staticClass:"operation-icon__btn el-icon-sort-down",on:{click:function(t){return e.planSort(s,i,"down")}}}),e._v(" "),a("i",{staticClass:"operation-icon__btn el-icon-edit",on:{click:function(t){return e.planEdit(s)}}}),e._v(" "),a("i",{staticClass:"operation-icon__btn el-icon-circle-close-outline",on:{click:function(t){return e.delPlan(s,i)}}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{resizable:!1,label:"程序流程"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,i=t.$index;return[a("el-select",{style:{width:s.isAdd||s.isEdit?"75%":"100%"},attrs:{placeholder:"程序流程"},model:{value:s.selectValue,callback:function(t){e.$set(s,"selectValue",t)},expression:"row.selectValue"}},e._l(s.flowPath,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}),1),e._v(" "),s.isAdd||s.isEdit?a("div",{staticClass:"procedure-operation"},[a("i",{staticClass:"el-icon-circle-close cursor",on:{click:function(t){return e.closeEdit(s)}}}),e._v(" "),a("i",{staticClass:"el-icon-circle-check cursor",on:{click:function(t){return e.addPlan(s,i)}}})]):e._e()]}}])})],1),e._v(" "),a("el-form",[a("el-form-item",{attrs:{label:"增加阶段"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"阶段"},model:{value:e.projectStage,callback:function(t){e.projectStage=t},expression:"projectStage"}}),e._v(" "),a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.saveProjectStage}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"right-wrapper"},[a("section",{staticClass:"title-bar clearfix margin-bottom__small"},[a("span",{staticClass:"titles"},[e._v("区县范围")]),e._v(" "),a("div",{staticClass:"pull-right"},[a("el-button",{on:{click:function(t){return e.handlerCheckbox(1)}}},[e._v("全选")]),e._v(" "),a("el-button",{on:{click:function(t){return e.handlerCheckbox(2)}}},[e._v("取消")]),e._v(" "),a("el-button",{on:{click:function(t){return e.handlerCheckbox(3)}}},[e._v("反选")])],1)]),e._v(" "),a("el-table",{staticClass:"tabel-normal",staticStyle:{width:"100%"},attrs:{data:e.townList}},[a("el-table-column",{attrs:{width:"40"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("el-checkbox",{model:{value:s.isChecked,callback:function(t){e.$set(s,"isChecked",t)},expression:"row.isChecked"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"区县名称",prop:"name",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{label:"责任单位"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("el-input",{attrs:{disabled:!s.isChecked},model:{value:s.danwei,callback:function(t){e.$set(s,"danwei",t)},expression:"row.danwei"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"市教育局定点联系领导"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("el-input",{attrs:{disabled:!s.isChecked},model:{value:s.lingdao,callback:function(t){e.$set(s,"lingdao",t)},expression:"row.lingdao"}})]}}])})],1)],1)])],1)],1),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{type:"primary"},on:{click:e.finalSave}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.cancelSave}},[e._v("取消")])],1)])},staticRenderFns:[]};var d=a("C7Lr")(r,c,!1,function(e){a("Urza")},null,null);t.default=d.exports},Urza:function(e,t){},WJGH:function(e,t,a){"use strict";a.d(t,"a",function(){return s}),a.d(t,"b",function(){return i});var s=[{id:13,type:1,name:"未开工",isDao:1,plan:"征地",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:13,type:1,name:"未开工",isDao:1,plan:"设计",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:13,type:1,name:"未开工",isDao:1,plan:"图审",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:13,type:1,name:"未开工",isDao:1,plan:"",isAdd:!0,flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:133,type:2,name:"进行中",isDao:1,plan:"主体开工",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:133,type:2,name:"进行中",isDao:1,plan:"装修",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:133,type:2,name:"进行中",isDao:1,plan:"",isAdd:!0,flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:1332,type:3,name:"投入使用",isDao:1,plan:"投入使用",flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]},{id:1332,type:3,name:"投入使用",isDao:1,plan:"",isAdd:!0,flowPath:[{label:"用地预审",id:1232},{label:"立项",id:12323},{label:"地质勘察地质勘察地质勘察",id:123222}]}],i=[{id:1,name:"章贡区",danwei:"",lingdao:""},{id:2,name:"南康区",danwei:"",lingdao:""},{id:3,name:"赣县区",danwei:"",lingdao:""},{id:4,name:"信丰区",danwei:"",lingdao:""}]}});
//# sourceMappingURL=8.f249d34355f6a96bca44.js.map