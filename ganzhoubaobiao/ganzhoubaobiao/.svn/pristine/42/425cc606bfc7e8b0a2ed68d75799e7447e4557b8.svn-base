webpackJsonp([22],{"2hCm":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("3cXf"),l=s.n(i),a=["#fee9e9","#e1f5fe","#e8f6ed"],o={data:function(){return{value:"",options:[{value:"选项1",label:"黄金糕"}],tableData:[],tableData1:[{id:1,time:"2018-12-11  17:20",plan:"设计",money:100,imgs:[s("7Otq"),s("7Otq")]}],tableHistory:[{date:"2016年05月02日 17:20",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄",src:s("7Otq")}],dialogTime:!1,dialogVisible:!1,dialogImageUrl:"",checkbox:!1,radio:1,colors:a,planList:[{id:1,name:"未开工",type:1,currentPlan:1,list:[{label:"征地",value:1},{label:"图审",value:2}]}],projectId:this.$route.params.projectId,schoolId:this.$route.params.schoolId,schoolScheduleId:this.$route.params.schoolScheduleId,edit:this.$route.params.edit,townId:sessionStorage.getItem("townId"),project:{},historyList:[],schuledlist:[],change:!1,form:{},fileList:[],fileStr:"",invest:"",nowSchedule:"",reward:"",daopaiList:[]}},computed:{fileLists:function(){var t=[];return this.fileList.forEach(function(e,s){t.push({name:e.fileName,url:e.fileUrl})}),t}},mounted:function(){var t=this;this.$nextTick(function(){t.init(),t.quryHistory(),t.initSchoolInfo(),t.queryDaopaishijian()})},methods:{init:function(){var t=this;this.$post("/web/queryTownProject",{projectId:this.projectId,townId:this.townId,schoolId:this.schoolId}).then(function(e){0==e.resultCode&&(t.project=e.content.project)}),null!=this.schoolScheduleId&&""!=this.schoolScheduleId&&this.$post("/web/findSchoolSchedule",{id:this.schoolScheduleId}).then(function(e){if(0==e.resultCode){var s=e.content.tSchoolSchedule;t.nowSchedule=s.scheduleId+"",t.invest=s.invest,t.reward=s.reward,t.fileList=e.content.fileList}}),this.$post("/web/queryProjectSchedule",{projectId:this.projectId,townId:this.townId}).then(function(e){if(0==e.resultCode){var s=[];e.content.list.forEach(function(t,e){s.length&&t.id===s[s.length-1].id?s[s.length-1].list.push(t):(t.list=[t],s.push(t))}),t.schuledlist=s}})},save:function(){var t=this;this.fileStr=l()(this.fileList),""!=this.invest?(isNaN(this.invest)&&this.$message({message:"本月投入只能是数字!"}),this.$post("/web/saveSchoolSchedule",{scheduleId:this.nowSchedule,schoolId:this.schoolId,invest:this.invest,reward:this.reward,fileStr:this.fileStr,id:this.schoolScheduleId}).then(function(e){t.$message({type:"success",message:"申报成功!"}),t.quxiao()})):this.$message({message:"本月投入不能为空!"})},queryDaopaishijian:function(){var t=this;this.$post("/web/queryDaopaishijian",{schoolId:t.schoolId}).then(function(e){0==e.resultCode&&(t.daopaiList=e.content.list)})},quryHistory:function(){var t=this;this.$post("/web/querySchoolSchedule",{schoolId:t.schoolId}).then(function(e){0==e.resultCode&&(t.historyList=e.content.list)})},initSchoolInfo:function(){var t=this;this.$post("/web/queryOneSchool",{id:t.schoolId,projectId:this.projectId}).then(function(e){0==e.resultCode&&(t.form=e.content.school)})},changeState:function(t){var e=this;this.$post("/web/changeDaopaishijian",{id:t.id}).then(function(t){0==t.resultCode&&e.$message({type:"success",message:"状态更新成功!"})})},handleRemove:function(t,e){var s=this.fileLists.indexOf(t);this.fileLists.splice(s,1),this.fileList.splice(s,1)},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url||t,this.dialogVisible=!0},newhandlesuccess:function(t,e){if(0==t.resultCode)this.fileList.push({fileName:t.content.fileName,fileUrl:t.content.fileUrl});else if("tolarge"==t.resultCode){this.$message("文件大小不能超过50M");var s=this.fileLists.indexOf(t);return this.fileLists.splice(s,1),void this.fileList.splice(s,1)}},getSpanArr:function(t){this._spanArr=[];for(var e=0;e<t.length;e++)0===e?(this._spanArr.push(1),this._pos=0):t[e].id===t[e-1].id?(this._spanArr[this._pos]+=1,this._spanArr.push(0)):(this._spanArr.push(1),this._pos=e)},arraySpanMethod:function(t){t.row,t.column;var e=t.rowIndex;if(0===t.columnIndex){var s=this._spanArr[e];return{rowspan:s,colspan:s>0?1:0}}},setCellStyle:function(t){t.row,t.column,t.rowIndex;return 0===t.columnIndex?(void 0===this._index?this._index=0:this._index++,{backgroundColor:a[this._index%3],fontSize:"16px"}):{color:"#606266"}},quxiao:function(){this.$router.push({name:"CountyProjectDetail",params:{projectId:this.projectId}})}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"city-add__wrapper plate"},[s("div",{staticClass:"plate-bottom has-padding has-radius margin-bottom__small"},[s("el-row",{attrs:{gutter:18}},[s("el-col",{attrs:{span:24}},[s("el-form",{attrs:{"label-width":"85px"}},[s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"学校名称"}},[s("el-input",{attrs:{disabled:""},model:{value:t.form.schoolName,callback:function(e){t.$set(t.form,"schoolName",e)},expression:"form.schoolName"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"开工年份"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"year",placeholder:"选择年",disabled:""},model:{value:t.project.startTime,callback:function(e){t.$set(t.project,"startTime",e)},expression:"project.startTime"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"竣工年份"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"year",placeholder:"选择年",disabled:""},model:{value:t.project.endTime,callback:function(e){t.$set(t.project,"endTime",e)},expression:"project.endTime"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"建筑面积"}},[s("el-input",{attrs:{disabled:""},model:{value:t.project.area,callback:function(e){t.$set(t.project,"area",e)},expression:"project.area"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"新增学位"}},[s("el-input",{attrs:{disabled:""},model:{value:t.project.newBuild,callback:function(e){t.$set(t.project,"newBuild",e)},expression:"project.newBuild"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"规划投资"}},[s("el-input",{attrs:{disabled:""},model:{value:t.project.invest,callback:function(e){t.$set(t.project,"invest",e)},expression:"project.invest"}})],1)],1),t._v(" "),s("el-col",{staticClass:"text-right",attrs:{span:8}},[s("span",{staticStyle:{color:"#f63636"}},[t._v("累计完成投资"+t._s(t.project.totalInvest))])])],1)],1),t._v(" "),s("section",{staticClass:"plan-list__wrapper"},[s("p",{staticClass:"margin-bottom__mini"},[t._v("进度情况")]),t._v(" "),t._l(t.schuledlist,function(e,i){return s("table",{key:i,staticClass:"plan-table"},[s("tr",{style:{"background-color":t.colors[i%3]}},[s("th",{staticClass:"text-left"},[t._v(t._s(e.stage))]),t._v(" "),s("th",[0==i?s("div",{staticClass:"time-icon__wrapper text-center pull-right"},[s("i",{staticClass:"el-icon-time",on:{click:function(e){t.dialogTime=!0}}})]):t._e()])]),t._v(" "),s("tr",[s("td",{attrs:{colspan:"2"}},t._l(e.list,function(e,i){return s("el-radio",{key:i,attrs:{label:e.scheduleId,border:""},model:{value:t.nowSchedule,callback:function(e){t.nowSchedule=e},expression:"nowSchedule"}},[t._v(t._s(e.scheduleName))])}),1)])])}),t._v(" "),s("el-form",{attrs:{"label-width":"70px"}},[s("el-form-item",{attrs:{label:"本月投入"}},[s("el-input",{staticStyle:{width:"100px"},attrs:{maxlength:"10"},model:{value:t.invest,callback:function(e){t.invest=e},expression:"invest"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"重点说明"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:5},maxlength:"200"},model:{value:t.reward,callback:function(e){t.reward=e},expression:"reward"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"上传材料"}},[s("el-upload",{attrs:{action:"/ganzhoubaobiao/web/uploadFile","on-preview":t.handlePictureCardPreview,"list-type":"picture-card","file-list":t.fileLists,"on-success":t.newhandlesuccess,"on-remove":t.handleRemove}},[s("i",{staticClass:"el-icon-plus"})]),t._v(" "),s("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),s("el-form-item",{staticClass:"text-right"},["see"!=t.edit?s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确定")]):t._e(),t._v(" "),"see"!=t.edit?s("el-button",{on:{click:t.quxiao}},[t._v("取消")]):s("el-button",{on:{click:t.quxiao}},[t._v("返回")])],1)],1)],2)],1),t._v(" "),s("el-col",{attrs:{span:24}},[s("div",{staticClass:"right-wrapper"},[s("p",{staticClass:"title-bar"},[s("span",{staticClass:"titles"},[t._v("历史提交记录")])]),t._v(" "),s("section",{staticStyle:{"margin-left":"-10px","margin-right":"-10px"}},[s("el-table",{staticClass:"table-wipeoff-bg",staticStyle:{width:"100%"},attrs:{data:t.historyList}},[s("el-table-column",{attrs:{prop:"finishTime",label:"时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[s("span",[t._v(t._s(t._f("YMDHms")(i.finishTime)))])]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"name",label:"进度"}}),t._v(" "),s("el-table-column",{attrs:{prop:"invest",label:"金额"}}),t._v(" "),s("el-table-column",{attrs:{label:"照片/图片"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return t._l(i.fileList,function(e,i){return s("img",{key:i,staticClass:"cursor margin-bottom__mini margin-right__mini",attrs:{src:e.fileUrl,width:"50",alt:""},on:{click:function(s){return t.handlePictureCardPreview(e.fileUrl)}}})})}}])})],1)],1)])])],1)],1),t._v(" "),s("el-dialog",{staticClass:"common-modal",attrs:{title:"未开工时间确认",visible:t.dialogTime,width:"480"},on:{"update:visible":function(e){t.dialogTime=e}}},[s("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",data:t.daopaiList}},[s("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"70"}}),t._v(" "),s("el-table-column",{attrs:{prop:"name",label:"倒排工作项"}}),t._v(" "),s("el-table-column",{attrs:{label:"倒排时间节点",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[s("span",{staticClass:"state-style is-state__1-text"},[t._v(t._s(t._f("YMD")(i.time)))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return["see"!=t.edit&&1!=i.isFinish?s("el-button",{attrs:{type:"text"},on:{click:function(e){return t.changeState(i)}}},[t._v("完成")]):1==i.isFinish?s("span",{staticClass:"state-style is-state__1-text"},[t._v("已完成")]):s("span",{staticClass:"state-style is-state__1-text"},[t._v("-")])]}}])})],1)],1)],1)},staticRenderFns:[]};var r=s("C7Lr")(o,n,!1,function(t){s("MDEP")},null,null);e.default=r.exports},MDEP:function(t,e){}});
//# sourceMappingURL=22.0b38cad97869e66d7189.js.map